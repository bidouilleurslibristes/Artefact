- hosts: all
  gather_facts: yes
  become: yes

  vars:
    zoomachine:
      git_url: https://github.com/yoann-dufresne/ZooMachine-3.git
      path: "{{ansible_env.HOME}}/ZooMachine-3"
      requirement_path: code/slave/raspi/requirements.txt
      venv_path: code/slave/raspi/venv
    update_cache: yes

  tasks:
    - name: install python-apt
      command: apt-get -y install python-apt

    - name: install ubuntu packages
      apt: pkg={{ item }} state=installed update_cache={{ update_cache }}
      with_items:
        - git
        - python3
        - python3-pip
        - python3-virtualenv
        - libsmpeg-dev

    - name: Copy Zoomachine repository
      git: repo="{{zoomachine.git_url}}" dest="{{zoomachine.path}}"

    - name: Install virtualenv and pip dependancies
      pip:
        requirements={{ zoomachine.path }}/{{ zoomachine.requirement_path }}
        virtualenv={{ zoomachine.path }}/{{ zoomachine.venv_path }}
